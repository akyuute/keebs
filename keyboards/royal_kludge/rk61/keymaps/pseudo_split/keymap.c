#include QMK_KEYBOARD_H


enum layers {
    _QWERTY,
    _PINKY_REACH_CMK,
    _SYMB,
    _MVMT,
    _NUMB,
    _MOUSE,
    _MEDIA,
    _ADJUST,
};

#define BAC KC_BSPC
#define DEL KC_DEL
#define ENT KC_ENT
#define TAB KC_TAB
#define ESC KC_ESC
#define SPC KC_SPC

#define LS LSFT_T
#define RS RSFT_T
#define SG SGUI_T
#define LG LGUI_T
#define RG RGUI_T
#define LC LCTL_T
#define RC RCTL_T
#define LA LALT_T
#define RA RALT_T
#define CS(kc) LCTL(LSFT_T(kc))
#define GC(kc) LGUI_T(LCTL_T(kc))

#define SYMB(kc) LT(_SYMB, kc)
#define MVMT(kc) LT(_MVMT, kc)
#define NUMB(kc) LT(_NUMB, kc)
#define MOUSE(kc) LT(_MOUSE, kc)
#define MEDIA(kc) LT(_MEDIA, kc)
#define ADJUST(kc) LT(_ADJUST, kc)


const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {


    [_QWERTY] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        QK_REP,    KC_Q,      KC_W,      KC_E,      KC_R,      KC_T,      KC_NO,     KC_NO,     KC_Y,      KC_U,      KC_I,      KC_O,      KC_P,      KC_BSPC,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_TAB,    KC_A,      LG(KC_S),  LA(KC_D),  LC(KC_F),  LS(KC_G),  KC_NO, RS(KC_H),  RC(KC_J),  RA(KC_K),  RG(KC_L),  KC_QUOT,   KC_SCLN, KC_TAB,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_ESC,    KC_Z,      KC_X,      KC_C,      KC_V,      KC_B,      KC_NO,     KC_N,      KC_M,      KC_COMM,   KC_DOT,    KC_MINS,   KC_ENT,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+-------------------------------------|
        KC_LSFT,   DM_REC1,   DM_PLY1,   NUMB(DEL), SYMB(ESC), LS(BAC),   MVMT(SPC), SYMB(ENT), MOUSE(TAB), DM_REC2,  DM_PLY2,   TO(_MOUSE),KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LGUI,   KC_LCTL,   MO(_MVMT),                                  QK_REP,                          KC_DEL,    KC_RALT,   KC_RCTL,   TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    ),

    [_PINKY_REACH_CMK] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        QK_REP,    KC_Q,      KC_G,      KC_W,      KC_F,      KC_P,      KC_NO,     KC_NO,     KC_K,      KC_U,      KC_Y,      KC_J,      KC_QUOT,   KC_BSPC,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_TAB,    KC_D,      LG(KC_A),  LA(KC_R),  LC(KC_S),  LS(KC_T),  KC_NO,     RS(KC_N),  RC(KC_E),  RA(KC_I),  RG(KC_O),  KC_H,   KC_SCLN,      KC_TAB,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_ESC, KC_Z, KC_X, KC_C, KC_V, KC_B, KC_NO, KC_L, KC_M, KC_COMM, KC_DOT, KC_MINS, KC_ENT,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+-------------------------------------|
        KC_LSFT,              DM_PLY1,   DM_PLY2,   NUMB(DEL), SYMB(ESC), LS(BAC),   MVMT(SPC), SYMB(ENT), MOUSE(TAB), KC_NO,    KC_NO,      TO(_MOUSE),KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LGUI,   KC_LCTL,   MO(_MVMT),                                  QK_REP,                          KC_DEL,    KC_RALT,   KC_RCTL,   TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    ),

    [_SYMB] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        KC_NO,     KC_PERC,   KC_CIRC,   KC_HASH,   KC_EQL,    KC_AT,     KC_NO,     KC_NO,     KC_AMPR,   KC_PLUS,   KC_ASTR,   KC_DLR,    KC_GRV,    KC_DEL,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_TAB, SG(KC_4), LG(KC_5), LA(KC_3), LC(KC_2), KC_1, KC_NO, KC_0, RC(KC_6), RA(KC_8), RG(KC_9), SG(KC_7), KC_PSCR, KC_TAB,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_ESC, KC_PIPE, KC_BSLS, KC_TILD, KC_SLSH, KC_SPC,    KC_NO, KC_SCLN, KC_COLN, KC_EXLM, KC_QUES, KC_BSPC, KC_ENT,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LSFT,              DM_REC1,   DM_REC2,   KC_DEL, KC_TRNS, KC_BSPC, KC_BSPC, KC_TRNS, KC_SPC, KC_NO, KC_NO, KC_RSFT, KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LGUI,   KC_LCTL,   KC_LSFT,   KC_SPC,    KC_NO,     KC_NO,     KC_NO,     TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    ),

    [_MVMT] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        KC_APP, KC_F2, KC_F5, KC_LCBR, KC_TAB, KC_RCBR, KC_NO, KC_NO, KC_HOME, KC_PGDN, KC_PGUP, KC_END, KC_SPC, KC_DEL, KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_TAB, KC_DEL, KC_LGUI, KC_LALT, KC_LCTL, KC_LSFT, KC_NO, KC_LEFT, KC_DOWN, KC_UP, KC_RGHT, KC_ENT, KC_BSPC, KC_TAB,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_ESC, LCTL(KC_Z), LCTL(KC_A), LCTL(KC_C), LCTL(KC_V), KC_SPC,   KC_NO,     KC_LPRN,   KC_LBRC,   KC_RBRC,   KC_RPRN,   KC_BSLS,   KC_ENT,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LSFT, KC_LALT, KC_TAB, KC_ENT, KC_ESC, KC_BSPC, KC_TRNS, KC_NO, KC_NO, KC_NO, KC_NO, KC_RSFT,KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LGUI, KC_LCTL, KC_TRNS, KC_LSFT, MO(_MEDIA), KC_NO, KC_NO, TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'
    ),

    [_NUMB] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        KC_NO, KC_F2, KC_F4, KC_ESC, KC_LALT, KC_DEL, KC_NO, KC_NO, KC_7, KC_8, KC_9, KC_ASTR, KC_PSLS, KC_DEL, KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_TAB, KC_PGDN, KC_PGUP, KC_SPC, KC_UP, KC_BSPC, KC_NO, KC_4, KC_5, KC_6, KC_PLUS, KC_PMNS, KC_BSPC, KC_ESC,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_ESC, KC_LSFT, KC_LCTL, KC_LEFT, KC_DOWN, KC_RGHT, KC_NO, KC_1, KC_2, KC_3, KC_DOT, KC_PEQL, KC_ENT,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LSFT, KC_HOME, KC_END, KC_TRNS, KC_F6, KC_SPC, KC_ENT, KC_0, MEDIA(SPC), KC_COMM, KC_BSPC, KC_RSFT, KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_ENT,    KC_LGUI,   KC_SPC,    KC_LSFT,   KC_TAB,    KC_NO,     KC_NO,     TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    ),

    [_MOUSE] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        KC_NO, KC_NO, MS_LEFT, KC_PGUP, KC_PGDN, MS_RGHT, KC_NO, KC_NO, LC(LS(TAB)), KC_NO, KC_NO, LCTL(KC_TAB), KC_NO, KC_BSPC,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_TAB, KC_DEL, KC_TAB, MS_WHLU, MS_UP, MS_WHLD, KC_NO, MS_BTN1, MS_BTN2, MS_BTN3, MS_ACL0, MS_ACL2, KC_TAB, KC_TAB,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_ESC, KC_BSPC, KC_ENT, MS_LEFT, MS_DOWN, MS_RGHT, KC_NO, KC_SPC, MS_BTN4, MS_BTN5, KC_APP, KC_ENT, KC_ENT,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_LSFT,              KC_LCTL, KC_TAB, MEDIA(ESC),   KC_ESC, KC_LSFT, KC_NO, KC_NO, KC_TRNS, KC_NO, KC_NO, KC_RSFT,KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_NO, KC_NO, KC_LALT, KC_SPC, KC_NO, KC_NO, KC_NO, TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    ),

    [_MEDIA] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        KC_SLEP, KC_BRID, KC_BRIU, KC_MPRV, KC_MPLY, KC_MNXT, KC_NO, KC_NO, KC_MRWD, KC_MSTP, KC_MFFD, KC_VOLD, KC_VOLU, KC_MUTE,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_NO,     KC_F4,     KC_F5,     KC_F3,     KC_F2,     KC_F1,     KC_NO,     KC_F10,    KC_F6,     KC_F8,     KC_F9,     KC_F7,     KC_NO,     KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_NO,     RGB_MOD,   RGB_HUD,   RGB_SAD,   RGB_VAD,   KC_F11,    KC_NO,     KC_F12,    RGB_VAI,   RGB_SAI,   RGB_HUI,   RGB_TOG,   KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_NO,                KC_NO,     KC_NO,     KC_TRNS, MO(_ADJUST), KC_NO,     KC_NO,   MO(_ADJUST), KC_TRNS,   KC_NO,     KC_NO,     KC_RSFT,KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_NO,     KC_NO,     KC_TRNS,   KC_MPLY,   KC_TRNS,   KC_NO,     KC_NO,     TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    ),

    [_ADJUST] = LAYOUT_all(

//     ,----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------.
        EE_CLR,    KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     PDF(_QWERTY), PDF(_PINKY_REACH_CMK), KC_NO, KC_NO, KC_NO, KC_NO, KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+---------------|
        QK_BOOT,   KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_NO,                KC_NO,     KC_NO,     KC_NO,     KC_TRNS,   KC_NO,     KC_NO,     KC_TRNS,   KC_NO,     KC_NO,     KC_NO,     KC_RSFT,KC_NO,KC_NO,
//     |----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+----------+--------------------------|
        KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     KC_NO,     TO(0)
//     `--------------------------------------------------------------------------------------------------------------------------------------------------------------'

    )
};


uint16_t get_tapping_term(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        // The shortest time for rolling into a new layer determines
        // the longest time for rolling off the outer layer's tap key.
        case MVMT(KC_SPC):
            return 150;

        // Alpha keys get more time to help avoid errors.
        // The downside is that they need to be held longer to trigger.
        case SYMB(KC_V):
        case SYMB(KC_M):
        case LS(KC_G):
        case LS(KC_H):
            return 160;

        default:
            return 120;
    }
}

bool get_retro_tapping(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case LS(KC_BSPC):
            // Never emit Backspace when this Shift is held for longer than the Tap Time.
            return false;
        default:
            // Emit the long-tapped key in every other case.
            return true;
    }
}

bool get_hold_on_other_key_press(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
        case LS(KC_BSPC):
        case SYMB(KC_ESC):
            // Immediately activate this Shift upon another keypress.
            return true;
        default:
            // Use the default tap-or-hold decision mode for any other mod-tap key.
            return false;
    }
}

